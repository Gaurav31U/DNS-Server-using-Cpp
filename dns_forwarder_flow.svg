<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: dns_forwarder_flow Pages: 1 -->
<svg width="1199pt" height="761pt"
 viewBox="0.00 0.00 1199.00 761.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 757)">
<title>dns_forwarder_flow</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-757 1195,-757 1195,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_client</title>
<polygon fill="lightgrey" stroke="lightgrey" points="883,-670 883,-745 1049,-745 1049,-670 883,-670"/>
<text text-anchor="middle" x="966" y="-729.8" font-family="Times,serif" font-size="14.00">Client</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_forwarder</title>
<polygon fill="lightyellow" stroke="lightyellow" points="220,-126 220,-488 1183,-488 1183,-126 220,-126"/>
<text text-anchor="middle" x="701.5" y="-472.8" font-family="Times,serif" font-size="14.00">Your DNS Forwarder (C++ Program)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_resolver</title>
<polygon fill="lightgrey" stroke="lightgrey" points="8,-269.5 8,-344.5 210,-344.5 210,-269.5 8,-269.5"/>
<text text-anchor="middle" x="109" y="-329.3" font-family="Times,serif" font-size="14.00">Upstream DNS Resolver</text>
</g>
<!-- client -->
<g id="node1" class="node">
<title>client</title>
<ellipse fill="lightblue" stroke="black" cx="966" cy="-696" rx="75.29" ry="18"/>
<text text-anchor="middle" x="966" y="-692.3" font-family="Times,serif" font-size="14.00">Client Application</text>
</g>
<!-- client_query -->
<g id="node11" class="node">
<title>client_query</title>
<path fill="white" stroke="black" d="M847,-554.5C847,-554.5 907,-554.5 907,-554.5 913,-554.5 919,-560.5 919,-566.5 919,-566.5 919,-578.5 919,-578.5 919,-584.5 913,-590.5 907,-590.5 907,-590.5 847,-590.5 847,-590.5 841,-590.5 835,-584.5 835,-578.5 835,-578.5 835,-566.5 835,-566.5 835,-560.5 841,-554.5 847,-554.5"/>
<text text-anchor="middle" x="877" y="-568.8" font-family="Times,serif" font-size="14.00">client_query</text>
</g>
<!-- client&#45;&gt;client_query -->
<g id="edge1" class="edge">
<title>client&#45;&gt;client_query</title>
<path fill="none" stroke="black" d="M904.8,-685.47C904.8,-685.47 904.8,-600.91 904.8,-600.91"/>
<polygon fill="black" stroke="black" points="908.3,-600.91 904.8,-590.91 901.3,-600.91 908.3,-600.91"/>
</g>
<!-- recv -->
<g id="node2" class="node">
<title>recv</title>
<path fill="lightblue" stroke="black" d="M847.5,-457C847.5,-457 722.5,-457 722.5,-457 716.5,-457 710.5,-451 710.5,-445 710.5,-445 710.5,-431 710.5,-431 710.5,-425 716.5,-419 722.5,-419 722.5,-419 847.5,-419 847.5,-419 853.5,-419 859.5,-425 859.5,-431 859.5,-431 859.5,-445 859.5,-445 859.5,-451 853.5,-457 847.5,-457"/>
<text text-anchor="middle" x="785" y="-441.8" font-family="Times,serif" font-size="14.00">1. recvfrom(udpSocket)</text>
<text text-anchor="middle" x="785" y="-426.8" font-family="Times,serif" font-size="14.00">Waits for incoming data</text>
</g>
<!-- parse_req -->
<g id="node3" class="node">
<title>parse_req</title>
<path fill="lightblue" stroke="black" d="M957,-322C957,-322 773,-322 773,-322 767,-322 761,-316 761,-310 761,-310 761,-281 761,-281 761,-275 767,-269 773,-269 773,-269 957,-269 957,-269 963,-269 969,-275 969,-281 969,-281 969,-310 969,-310 969,-316 963,-322 957,-322"/>
<text text-anchor="middle" x="865" y="-306.8" font-family="Times,serif" font-size="14.00">2. Parse Query Header &amp; Question</text>
<text text-anchor="middle" x="865" y="-291.8" font-family="Times,serif" font-size="14.00">memcpy() ID, Flags</text>
<text text-anchor="middle" x="865" y="-276.8" font-family="Times,serif" font-size="14.00">parse_qname() for domain</text>
</g>
<!-- recv&#45;&gt;parse_req -->
<g id="edge3" class="edge">
<title>recv&#45;&gt;parse_req</title>
<path fill="none" stroke="black" d="M810.25,-418.78C810.25,-418.78 810.25,-332.17 810.25,-332.17"/>
<polygon fill="black" stroke="black" points="813.75,-332.17 810.25,-322.17 806.75,-332.17 813.75,-332.17"/>
<text text-anchor="middle" x="869" y="-368" font-family="Times,serif" font-size="10.00">Buffer with raw bytes</text>
</g>
<!-- build_fwd_req -->
<g id="node4" class="node">
<title>build_fwd_req</title>
<path fill="lightblue" stroke="black" d="M546.5,-172C546.5,-172 247.5,-172 247.5,-172 241.5,-172 235.5,-166 235.5,-160 235.5,-160 235.5,-146 235.5,-146 235.5,-140 241.5,-134 247.5,-134 247.5,-134 546.5,-134 546.5,-134 552.5,-134 558.5,-140 558.5,-146 558.5,-146 558.5,-160 558.5,-160 558.5,-166 552.5,-172 546.5,-172"/>
<text text-anchor="middle" x="397" y="-156.8" font-family="Times,serif" font-size="14.00">3. Construct Forwarding Packet</text>
<text text-anchor="middle" x="397" y="-141.8" font-family="Times,serif" font-size="14.00">Create a new DNS query using original ID and question</text>
</g>
<!-- parse_req&#45;&gt;build_fwd_req -->
<g id="edge4" class="edge">
<title>parse_req&#45;&gt;build_fwd_req</title>
<path fill="none" stroke="black" d="M864,-268.54C864,-241.55 864,-204 864,-204 864,-204 510.25,-204 510.25,-204 510.25,-204 510.25,-182.28 510.25,-182.28"/>
<polygon fill="black" stroke="black" points="513.75,-182.28 510.25,-172.28 506.75,-182.28 513.75,-182.28"/>
<text text-anchor="middle" x="858" y="-218" font-family="Times,serif" font-size="10.00">Parsed data (ID, QNAME, etc.)</text>
</g>
<!-- forwarded_query -->
<g id="node12" class="node">
<title>forwarded_query</title>
<path fill="white" stroke="black" d="M27,-0.5C27,-0.5 113,-0.5 113,-0.5 119,-0.5 125,-6.5 125,-12.5 125,-12.5 125,-24.5 125,-24.5 125,-30.5 119,-36.5 113,-36.5 113,-36.5 27,-36.5 27,-36.5 21,-36.5 15,-30.5 15,-24.5 15,-24.5 15,-12.5 15,-12.5 15,-6.5 21,-0.5 27,-0.5"/>
<text text-anchor="middle" x="70" y="-14.8" font-family="Times,serif" font-size="14.00">forwarded_query</text>
</g>
<!-- build_fwd_req&#45;&gt;forwarded_query -->
<g id="edge5" class="edge">
<title>build_fwd_req&#45;&gt;forwarded_query</title>
<path fill="none" stroke="black" d="M397,-133.98C397,-95.5 397,-12 397,-12 397,-12 135.1,-12 135.1,-12"/>
<polygon fill="black" stroke="black" points="135.1,-8.5 125.1,-12 135.1,-15.5 135.1,-8.5"/>
<text text-anchor="middle" x="334.5" y="-83" font-family="Times,serif" font-size="10.00">Assembles new packet</text>
</g>
<!-- send_to_resolver -->
<g id="node5" class="node">
<title>send_to_resolver</title>
<path fill="lightblue" stroke="black" d="M428,-457C428,-457 240,-457 240,-457 234,-457 228,-451 228,-445 228,-445 228,-431 228,-431 228,-425 234,-419 240,-419 240,-419 428,-419 428,-419 434,-419 440,-425 440,-431 440,-431 440,-445 440,-445 440,-451 434,-457 428,-457"/>
<text text-anchor="middle" x="334" y="-441.8" font-family="Times,serif" font-size="14.00">4. sendto(forwardSocket)</text>
<text text-anchor="middle" x="334" y="-426.8" font-family="Times,serif" font-size="14.00">Sends the new query to the resolver</text>
</g>
<!-- resolver -->
<g id="node10" class="node">
<title>resolver</title>
<ellipse fill="lightblue" stroke="black" cx="109" cy="-295.5" rx="92.88" ry="18"/>
<text text-anchor="middle" x="109" y="-291.8" font-family="Times,serif" font-size="14.00">Resolver (e.g., 8.8.8.8)</text>
</g>
<!-- send_to_resolver&#45;&gt;resolver -->
<g id="edge7" class="edge">
<title>send_to_resolver&#45;&gt;resolver</title>
<path fill="none" stroke="black" d="M230.5,-418.71C230.5,-379.68 230.5,-295 230.5,-295 230.5,-295 212.01,-295 212.01,-295"/>
<polygon fill="black" stroke="black" points="212.01,-291.5 202.01,-295 212.01,-298.5 212.01,-291.5"/>
<text text-anchor="middle" x="184.5" y="-368" font-family="Times,serif" font-size="10.00">Packet sent over network</text>
</g>
<!-- recv_from_resolver -->
<g id="node6" class="node">
<title>recv_from_resolver</title>
<path fill="lightblue" stroke="black" d="M655,-457C655,-457 495,-457 495,-457 489,-457 483,-451 483,-445 483,-445 483,-431 483,-431 483,-425 489,-419 495,-419 495,-419 655,-419 655,-419 661,-419 667,-425 667,-431 667,-431 667,-445 667,-445 667,-451 661,-457 655,-457"/>
<text text-anchor="middle" x="575" y="-441.8" font-family="Times,serif" font-size="14.00">5. recvfrom(forwardSocket)</text>
<text text-anchor="middle" x="575" y="-426.8" font-family="Times,serif" font-size="14.00">Waits for the resolver&#39;s answer</text>
</g>
<!-- extract_answer -->
<g id="node7" class="node">
<title>extract_answer</title>
<path fill="lightblue" stroke="black" d="M706,-322C706,-322 474,-322 474,-322 468,-322 462,-316 462,-310 462,-310 462,-281 462,-281 462,-275 468,-269 474,-269 474,-269 706,-269 706,-269 712,-269 718,-275 718,-281 718,-281 718,-310 718,-310 718,-316 712,-322 706,-322"/>
<text text-anchor="middle" x="590" y="-306.8" font-family="Times,serif" font-size="14.00">6. Extract Answer Section</text>
<text text-anchor="middle" x="590" y="-291.8" font-family="Times,serif" font-size="14.00">Skips header/question in resolver&#39;s response</text>
<text text-anchor="middle" x="590" y="-276.8" font-family="Times,serif" font-size="14.00">Copies the answer bytes</text>
</g>
<!-- recv_from_resolver&#45;&gt;extract_answer -->
<g id="edge10" class="edge">
<title>recv_from_resolver&#45;&gt;extract_answer</title>
<path fill="none" stroke="black" d="M575,-418.78C575,-418.78 575,-332.17 575,-332.17"/>
<polygon fill="black" stroke="black" points="578.5,-332.17 575,-322.17 571.5,-332.17 578.5,-332.17"/>
<text text-anchor="middle" x="635" y="-368" font-family="Times,serif" font-size="10.00">Buffer with resolver&#39;s data</text>
</g>
<!-- build_final_resp -->
<g id="node8" class="node">
<title>build_final_resp</title>
<path fill="lightblue" stroke="black" d="M955,-172C955,-172 617,-172 617,-172 611,-172 605,-166 605,-160 605,-160 605,-146 605,-146 605,-140 611,-134 617,-134 617,-134 955,-134 955,-134 961,-134 967,-140 967,-146 967,-146 967,-160 967,-160 967,-166 961,-172 955,-172"/>
<text text-anchor="middle" x="786" y="-156.8" font-family="Times,serif" font-size="14.00">7. Construct Final Response Packet</text>
<text text-anchor="middle" x="786" y="-141.8" font-family="Times,serif" font-size="14.00">Assemble Header (QR=1), Question, and the extracted Answer</text>
</g>
<!-- extract_answer&#45;&gt;build_final_resp -->
<g id="edge11" class="edge">
<title>extract_answer&#45;&gt;build_final_resp</title>
<path fill="none" stroke="black" d="M661.5,-268.7C661.5,-268.7 661.5,-182.37 661.5,-182.37"/>
<polygon fill="black" stroke="black" points="665,-182.37 661.5,-172.37 658,-182.37 665,-182.37"/>
<text text-anchor="middle" x="668" y="-218" font-family="Times,serif" font-size="10.00">Just the answer bytes</text>
</g>
<!-- final_response -->
<g id="node14" class="node">
<title>final_response</title>
<path fill="white" stroke="black" d="M905.5,-0.5C905.5,-0.5 976.5,-0.5 976.5,-0.5 982.5,-0.5 988.5,-6.5 988.5,-12.5 988.5,-12.5 988.5,-24.5 988.5,-24.5 988.5,-30.5 982.5,-36.5 976.5,-36.5 976.5,-36.5 905.5,-36.5 905.5,-36.5 899.5,-36.5 893.5,-30.5 893.5,-24.5 893.5,-24.5 893.5,-12.5 893.5,-12.5 893.5,-6.5 899.5,-0.5 905.5,-0.5"/>
<text text-anchor="middle" x="941" y="-14.8" font-family="Times,serif" font-size="14.00">final_response</text>
</g>
<!-- build_final_resp&#45;&gt;final_response -->
<g id="edge12" class="edge">
<title>build_final_resp&#45;&gt;final_response</title>
<path fill="none" stroke="black" d="M930.25,-133.73C930.25,-133.73 930.25,-46.87 930.25,-46.87"/>
<polygon fill="black" stroke="black" points="933.75,-46.87 930.25,-36.87 926.75,-46.87 933.75,-46.87"/>
<text text-anchor="middle" x="897.5" y="-83" font-family="Times,serif" font-size="10.00">Assembles final response</text>
</g>
<!-- send_to_client -->
<g id="node9" class="node">
<title>send_to_client</title>
<path fill="lightblue" stroke="black" d="M1163,-457C1163,-457 915,-457 915,-457 909,-457 903,-451 903,-445 903,-445 903,-431 903,-431 903,-425 909,-419 915,-419 915,-419 1163,-419 1163,-419 1169,-419 1175,-425 1175,-431 1175,-431 1175,-445 1175,-445 1175,-451 1169,-457 1163,-457"/>
<text text-anchor="middle" x="1039" y="-441.8" font-family="Times,serif" font-size="14.00">8. sendto(udpSocket)</text>
<text text-anchor="middle" x="1039" y="-426.8" font-family="Times,serif" font-size="14.00">Sends the complete response back to the client</text>
</g>
<!-- send_to_client&#45;&gt;client -->
<g id="edge14" class="edge">
<title>send_to_client&#45;&gt;client</title>
<path fill="none" stroke="black" d="M980.2,-457.39C980.2,-457.39 980.2,-668.12 980.2,-668.12"/>
<polygon fill="black" stroke="black" points="976.7,-668.12 980.2,-678.12 983.7,-668.12 976.7,-668.12"/>
<text text-anchor="middle" x="1079.5" y="-570" font-family="Times,serif" font-size="10.00">Packet sent back to original client</text>
</g>
<!-- resolver_response -->
<g id="node13" class="node">
<title>resolver_response</title>
<path fill="white" stroke="black" d="M72,-135C72,-135 162,-135 162,-135 168,-135 174,-141 174,-147 174,-147 174,-159 174,-159 174,-165 168,-171 162,-171 162,-171 72,-171 72,-171 66,-171 60,-165 60,-159 60,-159 60,-147 60,-147 60,-141 66,-135 72,-135"/>
<text text-anchor="middle" x="117" y="-149.3" font-family="Times,serif" font-size="14.00">resolver_response</text>
</g>
<!-- resolver&#45;&gt;resolver_response -->
<g id="edge8" class="edge">
<title>resolver&#45;&gt;resolver_response</title>
<path fill="none" stroke="black" d="M98,-277.45C98,-277.45 98,-181.35 98,-181.35"/>
<polygon fill="black" stroke="black" points="101.5,-181.35 98,-171.35 94.5,-181.35 101.5,-181.35"/>
<text text-anchor="middle" x="159.5" y="-218" font-family="Times,serif" font-size="10.00">Looks up IP and responds</text>
</g>
<!-- client_query&#45;&gt;recv -->
<g id="edge2" class="edge">
<title>client_query&#45;&gt;recv</title>
<path fill="none" stroke="black" d="M847.25,-554.36C847.25,-554.36 847.25,-467.15 847.25,-467.15"/>
<polygon fill="black" stroke="black" points="850.75,-467.15 847.25,-457.15 843.75,-467.15 850.75,-467.15"/>
<text text-anchor="middle" x="898" y="-503" font-family="Times,serif" font-size="10.00">Packet arrives on Port 2053</text>
</g>
<!-- forwarded_query&#45;&gt;send_to_resolver -->
<g id="edge6" class="edge">
<title>forwarded_query&#45;&gt;send_to_resolver</title>
<path fill="none" stroke="black" d="M125.18,-24C172.47,-24 233,-24 233,-24 233,-24 233,-408.86 233,-408.86"/>
<polygon fill="black" stroke="black" points="229.5,-408.86 233,-418.86 236.5,-408.86 229.5,-408.86"/>
</g>
<!-- resolver_response&#45;&gt;recv_from_resolver -->
<g id="edge9" class="edge">
<title>resolver_response&#45;&gt;recv_from_resolver</title>
<path fill="none" stroke="black" d="M136,-171.01C136,-195.42 136,-236 136,-236 136,-236 451,-236 451,-236 451,-236 451,-438 451,-438 451,-438 472.93,-438 472.93,-438"/>
<polygon fill="black" stroke="black" points="472.93,-441.5 482.93,-438 472.93,-434.5 472.93,-441.5"/>
<text text-anchor="middle" x="353.5" y="-293" font-family="Times,serif" font-size="10.00">Packet arrives on forwardSocket</text>
</g>
<!-- final_response&#45;&gt;send_to_client -->
<g id="edge13" class="edge">
<title>final_response&#45;&gt;send_to_client</title>
<path fill="none" stroke="black" d="M978.75,-36.53C978.75,-36.53 978.75,-408.61 978.75,-408.61"/>
<polygon fill="black" stroke="black" points="975.25,-408.61 978.75,-418.61 982.25,-408.61 975.25,-408.61"/>
</g>
</g>
</svg>
